
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>beamon.database &#8212; Beamon SAD alpha documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for beamon.database</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">pandas.io.sql</span> <span class="k">as</span> <span class="nn">sql</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">queue</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
<span class="kn">from</span> <span class="nn">csv</span> <span class="kn">import</span> <span class="n">writer</span>
<span class="kn">import</span> <span class="nn">beamon.core</span> <span class="k">as</span> <span class="nn">beamcalc</span>

<span class="kn">from</span> <span class="nn">beamon.FileIntegrityError</span> <span class="kn">import</span> <span class="n">FileIntegrityError</span>


<div class="viewcode-block" id="Database"><a class="viewcode-back" href="../../api.html#beamon.database.Database">[docs]</a><span class="k">class</span> <span class="nc">Database</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;A data set to save all the data for constructing Elements in Visualization and for calculations in Beamon</span>
<span class="sd">    **Warning**: This class should follow singleton pattern.</span>

<span class="sd">    Important Attributes</span>
<span class="sd">    --------------------</span>

<span class="sd">    conn: SQLite3 connection object</span>

<span class="sd">    cur: cursor for SQLite queries</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Pandas Dataframes to save simulation results</span>
    <span class="c1"># TODO: change these pandas Dataframes to tables in the database</span>
    <span class="n">local_element_displacements</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">element_stats</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">local_element_section_forces</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">global_element_evaluation_points</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">global_element_displaced_points</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">nodes_results</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">global_displaced_nodes</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path_to_database</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ram</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">path_to_save_database</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Initiates a database with initial parameters. Database integrity will be checked upon loading.</span>

<span class="sd">        :param path_to_database: if not given a database name using a timestamp will be generated</span>
<span class="sd">        :type path_to_database: string</span>
<span class="sd">        :param check: Check database integrity. Default value is True</span>
<span class="sd">        :type check: boolean</span>
<span class="sd">        :param ram: Load Database to ram. Default False. If path is valid ram will be discarded.</span>
<span class="sd">        :type ram: boolean</span>
<span class="sd">        :param path_to_save_database: path to new database if a new database should be created</span>
<span class="sd">        :type path_to_save_database: string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">db_integrity</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">path_to_save_database</span>  <span class="c1"># name of the database to be shown on the window title</span>
        <span class="c1"># if no path is given</span>
        <span class="k">if</span> <span class="n">path_to_database</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># create an empty database</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">make_dummy_file</span><span class="p">(</span><span class="n">ram</span><span class="o">=</span><span class="n">ram</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">path_to_save_database</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># load database from path</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># connect to given database file</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">path_to_database</span><span class="p">,</span> <span class="n">check_same_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="c1"># create a cursor object to execute SQL queries</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
                <span class="n">db_integrity</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="k">if</span> <span class="n">check</span><span class="p">:</span>
                    <span class="n">db_integrity</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_database</span><span class="p">()</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">db_integrity</span><span class="p">:</span>
                    <span class="c1"># Database is failed check test</span>
                    <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span>
                        <span class="s2">&quot;Project database failed check test, check given path for the project file&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">Error</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;Project database failed to load. Database error: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
                <span class="c1"># msg = QMessageBox()</span>
                <span class="c1"># msg.setIcon(QMessageBox.Critical)</span>
                <span class="c1"># msg.setText(&quot;Projekt konnte nicht geladen werden&quot;)</span>
                <span class="c1"># msg.setInformativeText(&quot;Ein leeres Projekt wird erstellt&quot;)</span>
                <span class="c1"># msg.setDetailedText(</span>
                <span class="c1">#     &quot;Database error: %s&quot; % e)</span>
                <span class="c1"># msg.setStandardButtons(QMessageBox.Ok)</span>
                <span class="c1"># msg.exec()</span>
                <span class="c1"># db_integrity = False</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;Project database failed to load. Exception in query: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">e</span><span class="p">)</span>
                <span class="c1"># msg = QMessageBox()</span>
                <span class="c1"># msg.setIcon(QMessageBox.Critical)</span>
                <span class="c1"># msg.setText(&quot;Projekt konnte nicht geladen werden&quot;)</span>
                <span class="c1"># msg.setInformativeText(&quot;Ein leeres Projekt wird erstellt&quot;)</span>
                <span class="c1"># msg.setDetailedText(</span>
                <span class="c1">#     &quot;Exception in query: %s&quot; % e)</span>
                <span class="c1"># msg.setStandardButtons(QMessageBox.Ok)</span>
                <span class="c1"># msg.exec()</span>
                <span class="c1"># db_integrity = False</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="c1"># change database name</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">path_to_database</span>
                <span class="c1"># if not db_integrity:</span>
            <span class="c1">#         self.make_dummy_file(ram=ram)</span>
            <span class="c1">#     self.name = path_to_database</span>

        <span class="c1"># self.clear_database()</span>
        <span class="c1"># to make contains calls faster and reduce overhead</span>
        <span class="c1"># self.nodes_indexes = np.empty(1)</span>

<div class="viewcode-block" id="Database.make_dummy_file"><a class="viewcode-back" href="../../api.html#beamon.database.Database.make_dummy_file">[docs]</a>    <span class="k">def</span> <span class="nf">make_dummy_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ram</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create a new sqlite database according to given settings. This method contains CREATE queries for database</span>
<span class="sd">        tables.</span>

<span class="sd">        :param name: name of the database file. Default name is a string containing a timestamp as follows:</span>
<span class="sd">         Database_dd-mm-yyyy_hh-mm-ss</span>
<span class="sd">        :param ram: default:False. if True the database wil be loaded into the ram and not saved to hard drive</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%d</span><span class="s2">-%m-%Y_%H-%M-%S&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;database_&quot;</span> <span class="o">+</span> <span class="n">dt</span> <span class="o">+</span> <span class="s2">&quot;.db&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="n">ram</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;:memory:&quot;</span><span class="p">,</span> <span class="n">check_same_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">check_same_thread</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;Links&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;Nodes&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;Profile&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;Load&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;LineLoad&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;VisualizerSettings&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;DeletedNodes&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DROP TABLE IF EXISTS &quot;DeletedLinks&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="c1"># Create statements, see database model in documentation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CREATE TABLE IF NOT EXISTS &quot;Links&quot; (</span>
<span class="s2">                                &quot;id&quot;	INTEGER NOT NULL UNIQUE,</span>
<span class="s2">                                &quot;v_x&quot;   FLOAT NOT NULL,</span>
<span class="s2">                                &quot;v_y&quot;   FLOAT NOT NULL,</span>
<span class="s2">                                &quot;v_z&quot;   FLOAT NOT NULL,</span>
<span class="s2">                                &quot;n1_id&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;n2_id&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;Profile_id&quot;	INTEGER,</span>
<span class="s2">                                &quot;ux1&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;uy1&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;uz1&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;phix1&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;phiy1&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;phiz1&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;ux2&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;uy2&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;uz2&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;phix2&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;phiy2&quot; INTEGER NULL,</span>
<span class="s2">                                &quot;phiz2&quot; INTEGER NULL,</span>
<span class="s2">                                PRIMARY KEY(&quot;id&quot;),</span>
<span class="s2">                                FOREIGN KEY(&quot;n1_id&quot;) REFERENCES &quot;Nodes&quot;(&quot;id&quot;),</span>
<span class="s2">                                FOREIGN KEY(&quot;n2_id&quot;) REFERENCES &quot;Nodes&quot;(&quot;id&quot;),</span>
<span class="s2">                                FOREIGN KEY(&quot;Profile_id&quot;) REFERENCES &quot;Profile&quot;(&quot;id&quot;)</span>
<span class="s2">        );&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CREATE TABLE IF NOT EXISTS &quot;Nodes&quot; (</span>
<span class="s2">                                &quot;id&quot;	INTEGER NOT NULL UNIQUE,</span>
<span class="s2">                                &quot;x&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;y&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;z&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;u_x&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;u_y&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;u_z&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;phi_x&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;phi_y&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;phi_z&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;n_type&quot;  INTEGER NOT NULL,</span>
<span class="s2">                                PRIMARY KEY(&quot;id&quot;)</span>
<span class="s2">        );&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CREATE TABLE IF NOT EXISTS &quot;Profile&quot; (</span>
<span class="s2">                                &quot;id&quot;	INTEGER NOT NULL,</span>
<span class="s2">                                &quot;E&quot;	    REAL,</span>
<span class="s2">                                &quot;G&quot;	    REAL,</span>
<span class="s2">                                &quot;A&quot;     REAL,</span>
<span class="s2">                                &quot;Iy&quot;	REAL,</span>
<span class="s2">                                &quot;Iz&quot;	REAL,</span>
<span class="s2">                                &quot;kv&quot;	REAL,</span>
<span class="s2">                                &quot;k&quot;	REAL,</span>
<span class="s2">                                PRIMARY KEY(&quot;id&quot;)</span>
<span class="s2">        );&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CREATE TABLE IF NOT EXISTS &quot;Load&quot; (</span>
<span class="s2">                                &quot;id&quot;	INTEGER NOT NULL UNIQUE,</span>
<span class="s2">                                &quot;x&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;y&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;z&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;m_x&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;m_y&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;m_z&quot;	REAL NOT NULL,</span>
<span class="s2">                                &quot;node_id&quot; INTEGER NOT NULL,</span>
<span class="s2">                                &quot;lineload_id&quot; INTEGER,</span>
<span class="s2">                                FOREIGN KEY(&quot;node_id&quot;) REFERENCES &quot;Nodes&quot;(&quot;id&quot;),</span>
<span class="s2">                                FOREIGN KEY(&quot;lineload_id&quot;) REFERENCES &quot;Lineload&quot;(&quot;id&quot;) ON DELETE CASCADE,</span>
<span class="s2">                                PRIMARY KEY(&quot;id&quot;)</span>
<span class="s2">        );&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CREATE TABLE IF NOT EXISTS &quot;Lineload&quot; (</span>
<span class="s2">                                &quot;id&quot;	INTEGER NOT NULL UNIQUE,</span>
<span class="s2">                                &quot;qx&quot;    REAL,</span>
<span class="s2">                                &quot;qy&quot;    REAL,</span>
<span class="s2">                                &quot;qz&quot;    REAL,</span>
<span class="s2">                                &quot;qw&quot;    REAL,</span>
<span class="s2">                                &quot;link_id&quot; INTEGER NOT NULL,</span>
<span class="s2">                                FOREIGN KEY(&quot;link_id&quot;) REFERENCES &quot;Links&quot;(&quot;id&quot;) ON DELETE CASCADE,</span>
<span class="s2">                                PRIMARY KEY(&quot;id&quot;)</span>
<span class="s2">        );&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="c1"># TODO: add not null constraints after finishing</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;CREATE TABLE &quot;VisualizerSettings&quot; (</span>
<span class="s2">                                &quot;id&quot;	INTEGER,</span>
<span class="s2">                                &quot;grid_x1origin&quot;	REAL,</span>
<span class="s2">                                &quot;grid_x2origin&quot;	REAL,</span>
<span class="s2">                                &quot;grid_x3origin&quot;	REAL,</span>
<span class="s2">                                &quot;grid_n1&quot;	REAL,</span>
<span class="s2">                                &quot;grid_n2&quot;	REAL,</span>
<span class="s2">                                &quot;grid_n3&quot;	REAL,</span>
<span class="s2">                                &quot;grid_xtick&quot;	REAL,</span>
<span class="s2">                                &quot;grid_ytick&quot;	REAL,</span>
<span class="s2">                                &quot;view_dim&quot;      REAL,</span>
<span class="s2">                                &quot;show_labels&quot;   BLOB,</span>
<span class="s2">                                &quot;show_local_systems&quot; BLOB,</span>
<span class="s2">                                &quot;show_bc&quot; BLOB,</span>
<span class="s2">                                &quot;show_node_loads&quot; BLOB,</span>
<span class="s2">                                &quot;show_line_loads&quot; BLOB,</span>
<span class="s2">                                &quot;show_color_bar&quot; BLOB,</span>
<span class="s2">                                &quot;disp_nodes&quot; BLOB,</span>
<span class="s2">                                &quot;disp_elements&quot; BLOB,</span>
<span class="s2">                                &quot;nodes_sup_forces_trans&quot; BLOB,</span>
<span class="s2">                                &quot;nodes_sup_forces_mom&quot; BLOB,</span>
<span class="s2">                                &quot;elements_section_forces&quot; INTEGER,</span>
<span class="s2">                                &quot;displacements_scale&quot; REAL,</span>
<span class="s2">                                PRIMARY KEY(&quot;id&quot;)</span>
<span class="s2">        );&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="c1"># commit transaction</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.check_database"><a class="viewcode-back" href="../../api.html#beamon.database.Database.check_database">[docs]</a>    <span class="k">def</span> <span class="nf">check_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if the database has already been created or fails integrity check. Also checks if the following tables</span>
<span class="sd">        has dublicate entries: Nodes, Links</span>

<span class="sd">        :return: True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if the database has been created</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;PRAGMA schema_version;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># abort</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># check databases integrity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;PRAGMA integrity_check;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ok&#39;</span><span class="p">:</span>
            <span class="c1"># no errors occured</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># abort</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;PRAGMA foreign_key_check;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="c1"># no errors occured</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># abort</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># test if exception happen</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_links_indexes</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_links</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_nodes</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="c1"># check if tables has duplicates</span>
        <span class="n">n_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Nodes;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">l_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Links;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">duplicateRowsDF</span> <span class="o">=</span> <span class="n">n_df</span><span class="p">[</span><span class="n">n_df</span><span class="o">.</span><span class="n">duplicated</span><span class="p">([</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">])]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">duplicateRowsDF</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="n">duplicateRowsDF</span> <span class="o">=</span> <span class="n">l_df</span><span class="p">[</span><span class="n">l_df</span><span class="o">.</span><span class="n">duplicated</span><span class="p">([</span><span class="s1">&#39;n1_id&#39;</span><span class="p">,</span> <span class="s1">&#39;n2_id&#39;</span><span class="p">])]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">duplicateRowsDF</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.contains_node"><a class="viewcode-back" href="../../api.html#beamon.database.Database.contains_node">[docs]</a>    <span class="k">def</span> <span class="nf">contains_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;See if node with x,y,z coordinates exists. If index is given the index will be used to search</span>
<span class="sd">        if nothing was given then has_nodes() will be called.</span>

<span class="sd">        :param x: coordinate</span>
<span class="sd">        :param y: coordinate</span>
<span class="sd">        :param z: coordinate</span>
<span class="sd">        :param index: of the node</span>
<span class="sd">        :return: True if node exist, False if nodes doesnt exist</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># for testing</span>
        <span class="c1"># self.containscalls += 1</span>
        <span class="c1"># print(&quot;contains calls &quot; + str(self.containscalls))</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if nothing is given</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_nodes</span><span class="p">()</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># if only index is given</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM Nodes WHERE id=</span><span class="si">{index}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
            <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if only coordinates where given</span>
            <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">y</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM Nodes WHERE x=</span><span class="si">{x}</span><span class="s1"> and y=</span><span class="si">{y}</span><span class="s1"> and z=</span><span class="si">{z}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.has_nodes"><a class="viewcode-back" href="../../api.html#beamon.database.Database.has_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">has_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if there is any nodes in Nodes table.</span>

<span class="sd">        :return: True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT id FROM Nodes&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.contains_link"><a class="viewcode-back" href="../../api.html#beamon.database.Database.contains_link">[docs]</a>    <span class="k">def</span> <span class="nf">contains_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;If only index1 is given: see if a link with index1 exists.</span>

<span class="sd">        If index1 and index2 are given: see if a link with the nodes index1 and index2 exists.</span>

<span class="sd">        :param index1: Integer</span>
<span class="sd">        :param index2: Integer</span>
<span class="sd">        :return: True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index2</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">(</span><span class="n">index1</span><span class="p">,)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM Links WHERE id=</span><span class="si">{index}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">(</span><span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">,</span> <span class="n">index2</span><span class="p">,</span> <span class="n">index1</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s1">&#39;SELECT id FROM Links WHERE (n1_id=</span><span class="si">{index1}</span><span class="s1"> and n2_id=</span><span class="si">{index2}</span><span class="s1">) or (n1_id=</span><span class="si">{index2}</span><span class="s1"> and n2_id=</span><span class="si">{index1}</span><span class="s1">);&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">index1</span><span class="o">=</span><span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="o">=</span><span class="n">index2</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.has_links"><a class="viewcode-back" href="../../api.html#beamon.database.Database.has_links">[docs]</a>    <span class="k">def</span> <span class="nf">has_links</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if there is any links in Links table.</span>

<span class="sd">        :return: True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT id FROM Links&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.add_node"><a class="viewcode-back" href="../../api.html#beamon.database.Database.add_node">[docs]</a>    <span class="k">def</span> <span class="nf">add_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">u_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u_z</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">phi_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">phi_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">phi_z</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_type</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;adds a node with coordinates x,y,z and the freedom of movement for all 6 degrees of freedom (dof)</span>
<span class="sd">        default values for [u_x, .. ,phi_z] is e vector [1,...,1].</span>

<span class="sd">        :return False: if node already exists, True: if node has been added</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># if self.contains_node(x, y, z):</span>
        <span class="c1">#     return False</span>
        <span class="c1"># add a node with specific data</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">,</span> <span class="n">u_z</span><span class="p">,</span> <span class="n">phi_x</span><span class="p">,</span> <span class="n">phi_y</span><span class="p">,</span> <span class="n">phi_z</span><span class="p">,</span> <span class="n">n_type</span><span class="p">)</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;invalid input&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;INSERT INTO Nodes (id, x,y,z,u_x,u_y,u_z,phi_x,phi_y,phi_z, n_type) VALUES (NULL, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)&#39;</span><span class="p">,</span>
            <span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.change_node"><a class="viewcode-back" href="../../api.html#beamon.database.Database.change_node">[docs]</a>    <span class="k">def</span> <span class="nf">change_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">u_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u_z</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">phi_x</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">phi_y</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">phi_z</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Changes node information with specified index number.</span>

<span class="sd">        :return: True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="p">,</span> <span class="n">u_z</span><span class="p">,</span> <span class="n">phi_x</span><span class="p">,</span> <span class="n">phi_y</span><span class="p">,</span> <span class="n">phi_z</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;invalid input&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;UPDATE Nodes SET x=</span><span class="si">{x}</span><span class="s1">, y=</span><span class="si">{y}</span><span class="s1">,z=</span><span class="si">{z}</span><span class="s1">,u_x=</span><span class="si">{u_x}</span><span class="s1">,u_y=</span><span class="si">{u_y}</span><span class="s1">,u_z=</span><span class="si">{u_z}</span><span class="s1">,phi_x=</span><span class="si">{phi_x}</span><span class="s1">,phi_y=</span><span class="si">{phi_y}</span><span class="s1">, phi_z=</span><span class="si">{phi_z}</span><span class="s1"> WHERE id=</span><span class="si">{index}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">u_x</span><span class="o">=</span><span class="n">u_x</span><span class="p">,</span> <span class="n">u_y</span><span class="o">=</span><span class="n">u_y</span><span class="p">,</span> <span class="n">u_z</span><span class="o">=</span><span class="n">u_z</span><span class="p">,</span> <span class="n">phi_x</span><span class="o">=</span><span class="n">phi_x</span><span class="p">,</span> <span class="n">phi_y</span><span class="o">=</span><span class="n">phi_y</span><span class="p">,</span> <span class="n">phi_z</span><span class="o">=</span><span class="n">phi_z</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.remove_node"><a class="viewcode-back" href="../../api.html#beamon.database.Database.remove_node">[docs]</a>    <span class="k">def</span> <span class="nf">remove_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Drops a node from the nodes table.</span>
<span class="sd">        **Warning**: Dependent links and loads entries will be deleted.</span>

<span class="sd">        :param index: index of the node</span>
<span class="sd">        :return: True: if node has been successfully dropped, False: otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">):</span>
            <span class="c1"># all dependencies should be removed to prevent delete anomalies</span>
            <span class="c1"># remove all connected links first</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DELETE FROM Links WHERE n1_id=</span><span class="si">{index}</span><span class="s1"> or n2_id=</span><span class="si">{index}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
            <span class="c1"># remove all forces in relation with the node</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DELETE FROM Load WHERE node_id=</span><span class="si">{index}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
            <span class="c1"># finally delete the node</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DELETE from Nodes WHERE id=</span><span class="si">{index}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
            <span class="c1"># commit changes to the database</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="c1"># # update deleted nodes array</span>
            <span class="c1"># self.deleted_nodes.put(index)</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Database.change_dof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.change_dof">[docs]</a>    <span class="k">def</span> <span class="nf">change_dof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">u_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">u_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">u_z</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phi_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phi_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">phi_z</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;change the degree of freedom for a given node with specified node index. DOF specification:</span>
<span class="sd">         1 is completely free, 0 is locked.</span>

<span class="sd">        for example (index=300, u_x=1, u_y=1, u_z=1, phi_x=1, phi_y=1, phi_z=0) locks the rotation</span>
<span class="sd">        in the z axes of node 300.</span>

<span class="sd">        :param index: index of the node</span>
<span class="sd">        :param u_x: movement in x direction</span>
<span class="sd">        :param u_y: movement in y direction</span>
<span class="sd">        :param u_z: movement in z direction</span>
<span class="sd">        :param phi_x: rotation in x axes</span>
<span class="sd">        :param phi_y: rotation in y axes</span>
<span class="sd">        :param phi_z: rotation in z axes</span>
<span class="sd">        :return: True: if successfully changed/ False: if node not found</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if node exists</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="c1"># take values if given</span>
        <span class="k">if</span> <span class="n">u_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x1</span> <span class="o">=</span> <span class="n">u_x</span>
        <span class="k">if</span> <span class="n">phi_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x2</span> <span class="o">=</span> <span class="n">phi_x</span>
        <span class="k">if</span> <span class="n">u_y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y1</span> <span class="o">=</span> <span class="n">u_y</span>
        <span class="k">if</span> <span class="n">phi_y</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">y2</span> <span class="o">=</span> <span class="n">phi_y</span>
        <span class="k">if</span> <span class="n">u_z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">z1</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z1</span> <span class="o">=</span> <span class="n">u_z</span>
        <span class="k">if</span> <span class="n">phi_z</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">z2</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z2</span> <span class="o">=</span> <span class="n">phi_z</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;UPDATE Nodes SET u_x=</span><span class="si">{x1}</span><span class="s1">,u_y=</span><span class="si">{y1}</span><span class="s1">,u_z=</span><span class="si">{z1}</span><span class="s1">,phi_x=</span><span class="si">{x2}</span><span class="s1">,phi_y=</span><span class="si">{y2}</span><span class="s1">, phi_z=</span><span class="si">{z2}</span><span class="se">\n</span><span class="s1">&#39;</span>
                         <span class="s1">&#39;WHERE id=</span><span class="si">{index}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">x1</span><span class="o">=</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="o">=</span><span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="n">y2</span><span class="p">,</span> <span class="n">z1</span><span class="o">=</span><span class="n">z1</span><span class="p">,</span> <span class="n">z2</span><span class="o">=</span><span class="n">z2</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.add_link"><a class="viewcode-back" href="../../api.html#beamon.database.Database.add_link">[docs]</a>    <span class="k">def</span> <span class="nf">add_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">,</span> <span class="n">dof</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">profile_id</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">v_z</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Addes a link from node with index 1 to node with index2 and profile with profile_id</span>
<span class="sd">        if append is False a Link with specified values will be added.</span>

<span class="sd">        :param index1: starting node index</span>
<span class="sd">        :param index2: ending node index</span>
<span class="sd">        :param dof: degrees of freedom [ux1, uy1, uz1, phix1, ... , uz2, phix2, phiy2, phiz2]</span>
<span class="sd">        :param profile_id: optional index of the profile</span>
<span class="sd">        :param append: default True. Decide if the given Values should be appended to the database or not</span>
<span class="sd">        :param v_x: x component of the direction determiner of the z local axes</span>
<span class="sd">        :param v_y: y component of the direction determiner of the z local axes</span>
<span class="sd">        :param v_z: z component of the direction determiner of the z local axes</span>
<span class="sd">        :return: True: if successfully added a link, False: if one of the indexes don&#39;t exist</span>
<span class="sd">        or the profile index don&#39;t exist</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index1</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">index1</span> <span class="o">!=</span> <span class="n">index2</span><span class="p">):</span>
            <span class="c1"># get the default vector</span>
            <span class="k">if</span> <span class="n">v_x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_link_orientation</span><span class="p">(</span><span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">)</span>
                <span class="n">v_x</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">v_y</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">v_z</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">dof</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">dof</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_default_static_edof</span><span class="p">(</span><span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">profile_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_x</span><span class="p">,</span> <span class="n">v_y</span><span class="p">,</span> <span class="n">v_z</span><span class="p">,</span> <span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">,</span> <span class="n">dof</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                          <span class="n">dof</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="s1">&#39;INSERT INTO Links (id, v_x, v_y, v_z, n1_id, n2_id, Profile_id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2) VALUES (NULL, ?,?,?,?,?,NULL,?,?,?,?,?,?,?,?,?,?,?,?);&#39;</span><span class="p">,</span>
                    <span class="n">params</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">v_x</span><span class="p">,</span> <span class="n">v_y</span><span class="p">,</span> <span class="n">v_z</span><span class="p">,</span> <span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">,</span> <span class="n">profile_id</span><span class="p">,</span> <span class="n">dof</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span>
                          <span class="n">dof</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span>
                          <span class="n">dof</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">dof</span><span class="p">[</span><span class="mi">11</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                    <span class="s1">&#39;INSERT INTO Links (id, v_x, v_y, v_z, n1_id, n2_id, Profile_id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2) VALUES (NULL, ?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?);&#39;</span><span class="p">,</span>
                    <span class="n">params</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Database.change_link"><a class="viewcode-back" href="../../api.html#beamon.database.Database.change_link">[docs]</a>    <span class="k">def</span> <span class="nf">change_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">n1_id</span><span class="p">,</span> <span class="n">n2_id</span><span class="p">,</span> <span class="n">v_x</span><span class="p">,</span> <span class="n">v_y</span><span class="p">,</span> <span class="n">v_z</span><span class="p">,</span> <span class="n">profile_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Changes specific link values with index number.</span>

<span class="sd">        :return: True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">n1_id</span><span class="p">,</span> <span class="n">n2_id</span><span class="p">,</span> <span class="n">v_x</span><span class="p">,</span> <span class="n">v_y</span><span class="p">,</span> <span class="n">v_z</span><span class="p">,</span> <span class="n">profile_id</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;UPDATE Links SET n1_id=</span><span class="si">{n1_id}</span><span class="s2">, n2_id=</span><span class="si">{n2_id}</span><span class="s2">, v_x=</span><span class="si">{v_x}</span><span class="s2">, v_y=</span><span class="si">{v_y}</span><span class="s2">,v_z=</span><span class="si">{v_z}</span><span class="s2">, profile_id=</span><span class="si">{profile_id}</span><span class="s2"> WHERE id=</span><span class="si">{index}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">n1_id</span><span class="o">=</span><span class="n">n1_id</span><span class="p">,</span> <span class="n">n2_id</span><span class="o">=</span><span class="n">n2_id</span><span class="p">,</span> <span class="n">v_x</span><span class="o">=</span><span class="n">v_x</span><span class="p">,</span> <span class="n">v_y</span><span class="o">=</span><span class="n">v_y</span><span class="p">,</span> <span class="n">v_z</span><span class="o">=</span><span class="n">v_z</span><span class="p">,</span> <span class="n">profile_id</span><span class="o">=</span><span class="n">profile_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">change_edof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default_edof</span><span class="p">(</span><span class="n">index</span><span class="p">),</span> <span class="n">e_index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.remove_link"><a class="viewcode-back" href="../../api.html#beamon.database.Database.remove_link">[docs]</a>    <span class="k">def</span> <span class="nf">remove_link</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Drops a link from the links table.</span>

<span class="sd">        :param index: index of the link</span>
<span class="sd">        :return: True: if link has been successfully droppend, False: otherwise</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_link</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="c1"># all dependencies should be removed to prevent delete anomalies</span>
            <span class="c1"># remove all loads in relation with the link (solved thanks to ON DELETE CASCADE?)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DELETE from Links WHERE id=</span><span class="si">{index}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span></div>

<div class="viewcode-block" id="Database.remove_link_with_node"><a class="viewcode-back" href="../../api.html#beamon.database.Database.remove_link_with_node">[docs]</a>    <span class="k">def</span> <span class="nf">remove_link_with_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Drops a link from the Links table in relation with the node with index.</span>

<span class="sd">        Warning: Link should definitely have the node with index</span>
<span class="sd">        :param index: of the node</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DELETE FROM Links WHERE n1_id=</span><span class="si">{index}</span><span class="s1"> or n2_id=</span><span class="si">{index}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deleted_links</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">index</span><span class="p">)</span></div>
        <span class="c1"># TODO: nothing has been deleted. this may cause a problem</span>

<div class="viewcode-block" id="Database.get_default_link_orientation"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_default_link_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_link_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the default orientation vector of the element from starting node with index1 and ending node with index2</span>

<span class="sd">        :param index1: index of the starting node</span>
<span class="sd">        :param index2: index of the ending node</span>
<span class="sd">        :return: [v_x, v_y, v_z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_link_direction</span><span class="p">(</span><span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cross</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">result</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Database.get_link_direction"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_link_direction">[docs]</a>    <span class="k">def</span> <span class="nf">get_link_direction</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the normalized direction of the Link specified by starting and ending node indices.</span>

<span class="sd">        :param index1: index of the starting node</span>
<span class="sd">        :param index2: index of the ending node</span>
<span class="sd">        :return: [n_x, n_y, n_z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">index1</span><span class="p">,</span> <span class="n">index2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;SELECT n2.x-n1.x n_x, n2.y-n1.y n_y, n2.z-n1.z n_z FROM Nodes n1, Nodes n2 WHERE n1.id = ? and n2.id = ?&#39;</span><span class="p">,</span>
            <span class="n">params</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">n</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">n</span></div>

<div class="viewcode-block" id="Database.get_profiles"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_profiles">[docs]</a>    <span class="k">def</span> <span class="nf">get_profiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets all the profiles which are element properties [E G A I_y I_z K_z].</span>

<span class="sd">        :return: list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT E, G, A, Iy, Iz, kv, k from Profile&quot;&quot;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.change_profile"><a class="viewcode-back" href="../../api.html#beamon.database.Database.change_profile">[docs]</a>    <span class="k">def</span> <span class="nf">change_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">kv</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Changes certain profile values with index</span>

<span class="sd">        :return: True/False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">kv</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;UPDATE Profile SET E=</span><span class="si">{E}</span><span class="s2">, G=</span><span class="si">{G}</span><span class="s2">, A=</span><span class="si">{A}</span><span class="s2">, Iy=</span><span class="si">{Iy}</span><span class="s2">, Iz=</span><span class="si">{Iz}</span><span class="s2">, kv=</span><span class="si">{kv}</span><span class="s2">, k=</span><span class="si">{k}</span><span class="s2"> WHERE id=</span><span class="si">{index}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">E</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="n">G</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="n">A</span><span class="p">,</span> <span class="n">Iy</span><span class="o">=</span><span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="o">=</span><span class="n">Iz</span><span class="p">,</span> <span class="n">kv</span><span class="o">=</span><span class="n">kv</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">))</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.add_profile"><a class="viewcode-back" href="../../api.html#beamon.database.Database.add_profile">[docs]</a>    <span class="k">def</span> <span class="nf">add_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">kv</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a profile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="kc">None</span> <span class="ow">in</span> <span class="p">(</span><span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">Iy</span><span class="p">,</span> <span class="n">Iz</span><span class="p">,</span> <span class="n">kv</span><span class="p">,</span> <span class="n">k</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;INSERT INTO Profile (E, G, A, Iy, Iz,kv,k) VALUES (</span><span class="si">{E}</span><span class="s2">,</span><span class="si">{G}</span><span class="s2">,</span><span class="si">{A}</span><span class="s2">,</span><span class="si">{Iy}</span><span class="s2">,</span><span class="si">{Iz}</span><span class="s2">,</span><span class="si">{kv}</span><span class="s2">,</span><span class="si">{k}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">E</span><span class="o">=</span><span class="n">E</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="n">G</span><span class="p">,</span> <span class="n">A</span><span class="o">=</span><span class="n">A</span><span class="p">,</span> <span class="n">Iz</span><span class="o">=</span><span class="n">Iz</span><span class="p">,</span> <span class="n">Iy</span><span class="o">=</span><span class="n">Iy</span><span class="p">,</span> <span class="n">kv</span><span class="o">=</span><span class="n">kv</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">k</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.remove_profile"><a class="viewcode-back" href="../../api.html#beamon.database.Database.remove_profile">[docs]</a>    <span class="k">def</span> <span class="nf">remove_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes the profile with index</span>

<span class="sd">        :param index: of the profile</span>
<span class="sd">        :return: True: successful / False: not successful</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_profile</span><span class="p">(</span><span class="n">index</span><span class="p">)</span> <span class="ow">or</span> <span class="n">index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DELETE FROM Profile WHERE id=</span><span class="si">{index}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.erase_lost_profiles_in_links"><a class="viewcode-back" href="../../api.html#beamon.database.Database.erase_lost_profiles_in_links">[docs]</a>    <span class="k">def</span> <span class="nf">erase_lost_profiles_in_links</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove all profile foreign keys in table Links that has no reference.</span>
<span class="sd">        This is mainly used to reset all lost foreign keys in table links after deleting a profile tha have been used</span>
<span class="sd">        in links</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get lost foreign keys from table Profile</span>
        <span class="n">lost_stuff</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;PRAGMA foreign_key_check(Links)&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="c1"># get rowid with parent == Profile (get lost foreign key from profile table)</span>
        <span class="n">lost_profile_ids</span> <span class="o">=</span> <span class="n">lost_stuff</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">lost_stuff</span><span class="p">[</span><span class="s1">&#39;parent&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;Profile&#39;</span><span class="p">][</span><span class="s1">&#39;rowid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
        <span class="c1"># set profile_id to null</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="n">lost_profile_ids</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;UPDATE Links SET Profile_id=NULL WHERE id=</span><span class="si">{id}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="nb">id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.contains_profile"><a class="viewcode-back" href="../../api.html#beamon.database.Database.contains_profile">[docs]</a>    <span class="k">def</span> <span class="nf">contains_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Check if profile with index exists.</span>

<span class="sd">        :param index: profile index number</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        :return: True/False</span>
<span class="sd">        :rtype: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM Profile WHERE id=</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.get_node_id"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_node_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;gets the index of the node from row number.</span>

<span class="sd">        :param raw_index: the index of the raw</span>
<span class="sd">        :return: -1 if not found. Otherwise node id will be given</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># index represents the offset, which is exclusive, and 1 represents the quantity</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM Nodes LIMIT </span><span class="si">{index}</span><span class="s1">,1;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">raw_index</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># nothing found</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.get_node_index"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_node_index">[docs]</a>    <span class="k">def</span> <span class="nf">get_node_index</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;gets the index of the node from its given coordinates.</span>

<span class="sd">        :param x: coordinate</span>
<span class="sd">        :param y: coordinate</span>
<span class="sd">        :param z: coordinate</span>
<span class="sd">        :return: -1 if not found. Otherwise node index will be given</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT id FROM Nodes WHERE x=</span><span class="si">{x}</span><span class="s1"> and y=</span><span class="si">{y}</span><span class="s1"> and z=</span><span class="si">{z}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>  <span class="c1"># nothing found</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">results</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.get_nodes"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">get_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all nodes coordinates with/without a certain type.</span>

<span class="sd">        :return: numpy array for each node with the form [x, y, z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT x,y,z FROM Nodes;&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;static&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT x,y,z FROM Nodes WHERE n_type=1&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;free&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT x,y,z FROM Nodes WHERE n_type=2&quot;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span> <span class="o">==</span> <span class="s2">&quot;fluid&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT x,y,z FROM Nodes WHERE n_type=3&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Database.get_node"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_node">[docs]</a>    <span class="k">def</span> <span class="nf">get_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; gets the nodes x,y,z coordinates.</span>

<span class="sd">        :param index: of the node</span>
<span class="sd">        :return: None if node not found / numpy array with [x,y,z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;SELECT x,y,z FROM Nodes WHERE id=</span><span class="si">{index}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">results</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span></div>

<div class="viewcode-block" id="Database.get_all_nodes"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_all_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gets all nodes information in the DataSet. Used for the GUI-Table</span>
<span class="sd">        :return: table [x, y, z, u_x, u_y, u_z, phi_x, phi_y, phi_z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># sort all nodes indexes first</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_node_indexes</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;SELECT x,y,z,u_x,u_y,u_z,phi_x,phi_y,phi_z FROM Nodes;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.get_dof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_dof">[docs]</a>    <span class="k">def</span> <span class="nf">get_dof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get the dof values of the node with index.</span>

<span class="sd">        :param index: of the node</span>
<span class="sd">        :return: [u_x,u_y,u_z,phi_x,phi_y,phi_z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;SELECT x,y,z,u_x,u_y,u_z,phi_x,phi_y,phi_z FROM Nodes WHERE id=</span><span class="si">{index}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Database.get_all_dof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_all_dof">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_dof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all nodes information which has at least one dof number equals 1 (locked)</span>

<span class="sd">        :return: [x,y,z,u_x,u_y,u_z,phi_x,phi_y,phi_z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;SELECT x,y,z,u_x,u_y,u_z,phi_x,phi_y,phi_z FROM Nodes WHERE u_x=1 or u_y=1 or u_z=1 or phi_x=1 or phi_y=1 or phi_z=1&#39;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">result</span></div>

<div class="viewcode-block" id="Database.get_nodes_indexes_with_bc"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_nodes_indexes_with_bc">[docs]</a>    <span class="k">def</span> <span class="nf">get_nodes_indexes_with_bc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all nodes id numbers which have boundary conditions defined on them. Similar to get_all_dof but delivers</span>
<span class="sd">        nodes indices instead of all nodes information.</span>

<span class="sd">        :return: nodes indices</span>
<span class="sd">        :rtype: integer vector</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT id FROM Nodes WHERE u_x=1 or u_y=1 or u_z=1 or phi_x=1 or phi_y=1 or phi_z=1&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.get_bc"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_bc">[docs]</a>    <span class="k">def</span> <span class="nf">get_bc</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get only bc information from nodes.</span>

<span class="sd">        :return: [u_x,u_y,u_z,phi_x,phi_y,phi_z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT u_x,u_y,u_z,phi_x,phi_y,phi_z FROM Nodes&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></div>



<div class="viewcode-block" id="Database.get_links"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_links">[docs]</a>    <span class="k">def</span> <span class="nf">get_links</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets Links information for visualization puposes as line segment information.</span>

<span class="sd">        :return: numpy array for line segments with the form [x, y, z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># self.cur.execute(&quot;SELECT n1_id, n2_id FROM Links;&quot;)</span>
        <span class="c1"># get left coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT x x1,y y1,z z1 FROM Links l LEFT OUTER JOIN Nodes n ON l.n1_id = n.id&quot;</span><span class="p">)</span>
        <span class="n">left_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>
        <span class="c1"># get right coordinates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT x x2,y y2,z z2 FROM Links l LEFT OUTER JOIN Nodes n ON l.n2_id = n.id&quot;</span><span class="p">)</span>
        <span class="n">right_coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>

        <span class="c1"># if links is empty</span>
        <span class="k">if</span> <span class="n">left_coord</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">right_coord</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

        <span class="c1"># results array is a 1 dim array containing points representing line segments</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">left_coord</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>  <span class="c1"># preallocate</span>
        <span class="n">idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">left_coord</span><span class="p">)):</span>
            <span class="n">results</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">left_coord</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">results</span><span class="p">[</span><span class="n">idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">right_coord</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>

        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Database.get_all_links"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_all_links">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_links</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all links in the links table.</span>
<span class="sd">        Delivers the table as it is.</span>

<span class="sd">        :return: matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># sort all nodes indexes first</span>
        <span class="c1"># self.sort_node_indexes()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;SELECT n1_id, n2_id, v_x, v_y, v_z, Profile_id FROM Links&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">result</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.get_link_with_id"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_link_with_id">[docs]</a>    <span class="k">def</span> <span class="nf">get_link_with_id</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets link data with a certain id</span>

<span class="sd">        :param link_id: link id</span>
<span class="sd">        :type link_id: integer</span>
<span class="sd">        :return: link data</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Links WHERE id =</span><span class="si">{link_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">link_id</span><span class="o">=</span><span class="n">link_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.get_link_nodes"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_link_nodes">[docs]</a>    <span class="k">def</span> <span class="nf">get_link_nodes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">link_id</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets links starting and ending nodes indices.</span>

<span class="sd">        :param link_id: link id</span>
<span class="sd">        :type link_id: integer</span>
<span class="sd">        :return: [n1_id, n2_id]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT n1_id, n2_id FROM Links WHERE id =</span><span class="si">{link_id}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">link_id</span><span class="o">=</span><span class="n">link_id</span><span class="p">))</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span></div>

<div class="viewcode-block" id="Database.get_all_links_profile_indexes"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_all_links_profile_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_links_profile_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all the profiles indexes of the existing links.</span>

<span class="sd">        :return: None: if link index don&#39;t exist. Otherwise index of the profile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT Profile_id FROM Links&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">results</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Database.get_links_profiles"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_links_profiles">[docs]</a>    <span class="k">def</span> <span class="nf">get_links_profiles</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets profile data from links provided their profile id is set.</span>

<span class="sd">        :return: [E, G, A, Iy, Iz, Kv]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT p.E, p.G, p.A, p.Iy, p.Iz, p.Kv FROM Links l JOIN Profile p ON l.Profile_id = p.id&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></div>

<div class="viewcode-block" id="Database.get_links_indexes"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_links_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">get_links_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the column &#39;id&#39; of the Links table in the database.</span>

<span class="sd">        :return: numpy array [id]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT id FROM Links;&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">results</span></div>

<div class="viewcode-block" id="Database.get_link_orientations"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_link_orientations">[docs]</a>    <span class="k">def</span> <span class="nf">get_link_orientations</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;gets all local z-axes orientation information - plane normal vector (x axes) and v vector components</span>
<span class="sd">        (orientation definition vector for z axes).</span>

<span class="sd">        :return: x,y,z vectors for local system of all links</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># [n_x, n_y, n_z, v_x, v_y, v_z]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT n2.x-n1.x n_x, n2.y-n1.y n_y, n2.z-n1.z n_z, L.v_x, L.v_y, L.v_z FROM Links L</span>
<span class="s2">                        JOIN Nodes n1 ON L.n1_id = n1.id</span>
<span class="s2">                        JOIN Nodes n2 ON L.n2_id = n2.id</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">beamcalc</span><span class="o">.</span><span class="n">get_local_orientation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></div>

<div class="viewcode-block" id="Database.get_link_orientation"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_link_orientation">[docs]</a>    <span class="k">def</span> <span class="nf">get_link_orientation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; gets all local z-axes orientation information - plane normal vector (x axes) and v vector components</span>
<span class="sd">        (orientation definition vector for z axes).</span>

<span class="sd">        :param index: link index number</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        :return: x,y,z vectors for local system of the link</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># [n_x, n_y, n_z, v_x, v_y, v_z]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;SELECT n2.x-n1.x n_x, n2.y-n1.y n_y, n2.z-n1.z n_z, L.v_x, L.v_y, L.v_z FROM Links L JOIN Nodes n1 ON L.n1_id = n1.id JOIN Nodes n2 ON L.n2_id = n2.id WHERE L.id=</span><span class="si">{index}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">beamcalc</span><span class="o">.</span><span class="n">get_local_orientation</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></div>

<div class="viewcode-block" id="Database.get_links_starting_points"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_links_starting_points">[docs]</a>    <span class="k">def</span> <span class="nf">get_links_starting_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;gets x,y,z coordinates of all links start points.</span>
<span class="sd">        This is being used to plot local coordinate systems of the links.</span>

<span class="sd">        :return: [x,y,z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT n.x, n.y, n.z FROM Links L</span>
<span class="s2">                        JOIN Nodes n ON L.n1_id = n.id</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></div>

<div class="viewcode-block" id="Database.get_links_middle_points"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_links_middle_points">[docs]</a>    <span class="k">def</span> <span class="nf">get_links_middle_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;gets x,y,z coordinates of all links middle points.</span>
<span class="sd">        This could be used to plot local coordinate systems of the links</span>

<span class="sd">        :return: [x,y,z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT n1.x + (n2.x-n1.x)/2 x, n1.y+(n2.y-n1.y)/2 y, n1.z+(n2.z-n1.z)/2 z FROM Links L</span>
<span class="s2">                        JOIN Nodes n1 ON L.n1_id = n1.id</span>
<span class="s2">                        JOIN Nodes n2 ON L.n2_id = n2.id</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></div>

<div class="viewcode-block" id="Database.get_links_ending_points"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_links_ending_points">[docs]</a>    <span class="k">def</span> <span class="nf">get_links_ending_points</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;gets x,y,z coordinates of all links ending points.</span>
<span class="sd">        This could be used to plot local coordinate systems of the links.</span>

<span class="sd">        :return: [x,y,z]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT n.x, n.y, n.z FROM Links L</span>
<span class="s2">                        JOIN Nodes n ON L.n2_id = n.id</span>
<span class="s2">                    &quot;&quot;&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></div>

<div class="viewcode-block" id="Database.get_link_length"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_link_length">[docs]</a>    <span class="k">def</span> <span class="nf">get_link_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the length of the link with the index.</span>

<span class="sd">        :param index: of the link in the table Links</span>
<span class="sd">        :return: float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_link</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;SELECT n1.x - n2.x, n1.y - n2.y, n1.z - n2.z FROM Links L JOIN Nodes n1 ON L.n1_id = n1.id JOIN Nodes n2 ON L.n2_id = n2.id WHERE L.id = </span><span class="si">{index}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">]))</span></div>

<div class="viewcode-block" id="Database.get_loads_for_plotting"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_loads_for_plotting">[docs]</a>    <span class="k">def</span> <span class="nf">get_loads_for_plotting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Make a 9 column matrix containing (x,y,z,u,v,w, m_x,m_y,m_z) which are the positions and components of the</span>
<span class="sd">        forces applied to nodes.</span>
<span class="sd">        This method is necessary for plotting the node loads accordingly.</span>

<span class="sd">        :return: numpy array with [x,y,z,u,v,w, m_x,m_y,m_z]/ None: if empty loads table</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="sd">&quot;&quot;&quot;SELECT n.x, n.y, n.z, f.x, f.y, f.z, f.m_x, f.m_y, f.m_z FROM Nodes n JOIN Load f ON n.id = f.node_id WHERE f.lineload_id is NULL&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">results</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.get_loads"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_loads">[docs]</a>    <span class="k">def</span> <span class="nf">get_loads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all the nodes forces from Load table.</span>

<span class="sd">        :return: list matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span>
            <span class="s2">&quot;SELECT node_id, x, y, z, m_x, m_y, m_z FROM Load WHERE lineload_id IS NULL&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.change_load"><a class="viewcode-back" href="../../api.html#beamon.database.Database.change_load">[docs]</a>    <span class="k">def</span> <span class="nf">change_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">n_index</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">m_x</span><span class="p">,</span> <span class="n">m_y</span><span class="p">,</span> <span class="n">m_z</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change load information with specific index number.</span>

<span class="sd">        :param index: load index to be changed</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        :param n_index: node index number</span>
<span class="sd">        :type n_index: integer</span>
<span class="sd">        :param x: x-component</span>
<span class="sd">        :type x: float</span>
<span class="sd">        :param y: y-component</span>
<span class="sd">        :type y: float</span>
<span class="sd">        :param z: z-component</span>
<span class="sd">        :type z: float</span>
<span class="sd">        :param m_x: momentum in x-direction</span>
<span class="sd">        :type m_x: float</span>
<span class="sd">        :param m_y: momentum in y-direction</span>
<span class="sd">        :type m_y: float</span>
<span class="sd">        :param m_z: momentum in z-direction</span>
<span class="sd">        :type m_z: float</span>
<span class="sd">        :return: True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;UPDATE Load SET node_id=</span><span class="si">{n_index}</span><span class="s2">,x=</span><span class="si">{x}</span><span class="s2">,y=</span><span class="si">{y}</span><span class="s2">,z=</span><span class="si">{z}</span><span class="s2">,m_x=</span><span class="si">{m_x}</span><span class="s2">,m_y=</span><span class="si">{m_y}</span><span class="s2">,m_z=</span><span class="si">{m_z}</span><span class="s2"> WHERE id=</span><span class="si">{index}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">n_index</span><span class="o">=</span><span class="n">n_index</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">m_x</span><span class="o">=</span><span class="n">m_x</span><span class="p">,</span> <span class="n">m_y</span><span class="o">=</span><span class="n">m_y</span><span class="p">,</span> <span class="n">m_z</span><span class="o">=</span><span class="n">m_z</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.add_load"><a class="viewcode-back" href="../../api.html#beamon.database.Database.add_load">[docs]</a>    <span class="k">def</span> <span class="nf">add_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">m_x</span><span class="p">,</span> <span class="n">m_y</span><span class="p">,</span> <span class="n">m_z</span><span class="p">,</span> <span class="n">lineload_id</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;adds a load on the node with index</span>

<span class="sd">        :param index: node index number</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        :param x: first component of the force vector</span>
<span class="sd">        :type x: float</span>
<span class="sd">        :param y: second component of the force vector</span>
<span class="sd">        :type y: float</span>
<span class="sd">        :param z: third component of the force vector</span>
<span class="sd">        :type z: float</span>
<span class="sd">        :param m_x: first component of the momentum vector</span>
<span class="sd">        :type m_x: float</span>
<span class="sd">        :param m_y: second component of the momentum vector</span>
<span class="sd">        :type m_y: float</span>
<span class="sd">        :param m_z: third component of the momentum vector</span>
<span class="sd">        :type m_z: float</span>
<span class="sd">        :param lineload_id: optional number of reference lineload</span>
<span class="sd">        :type lineload_id: integer</span>
<span class="sd">        :return: True: if successfully added or updated / False: if node doesnt exist</span>
<span class="sd">        :rtype: boolean</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">if</span> <span class="n">lineload_id</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s1">&#39;INSERT INTO Load (x, y, z, m_x, m_y, m_z, node_id, lineload_id) VALUES (</span><span class="si">{x}</span><span class="s1">, </span><span class="si">{y}</span><span class="s1">, </span><span class="si">{z}</span><span class="s1">, </span><span class="si">{m_x}</span><span class="s1">, </span><span class="si">{m_y}</span><span class="s1">, </span><span class="si">{m_z}</span><span class="s1">, </span><span class="si">{index}</span><span class="s1">, NULL)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">m_x</span><span class="o">=</span><span class="n">m_x</span><span class="p">,</span> <span class="n">m_y</span><span class="o">=</span><span class="n">m_y</span><span class="p">,</span> <span class="n">m_z</span><span class="o">=</span><span class="n">m_z</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s1">&#39;INSERT INTO Load (x, y, z, m_x, m_y, m_z, node_id, lineload_id) VALUES (</span><span class="si">{x}</span><span class="s1">, </span><span class="si">{y}</span><span class="s1">, </span><span class="si">{z}</span><span class="s1">, </span><span class="si">{m_x}</span><span class="s1">, </span><span class="si">{m_y}</span><span class="s1">, </span><span class="si">{m_z}</span><span class="s1">, </span><span class="si">{index}</span><span class="s1">, </span><span class="si">{lineload_id}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">m_x</span><span class="o">=</span><span class="n">m_x</span><span class="p">,</span> <span class="n">m_y</span><span class="o">=</span><span class="n">m_y</span><span class="p">,</span> <span class="n">m_z</span><span class="o">=</span><span class="n">m_z</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">lineload_id</span><span class="o">=</span><span class="n">lineload_id</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>
        <span class="c1"># get the id of the last inserted row</span>
        <span class="c1"># self.cur.execute(&quot;&quot;&quot;SELECT lat_insert_rowid()&quot;&quot;&quot;)</span>
        <span class="c1"># id = self.cur.fetchall()[0]</span>

<div class="viewcode-block" id="Database.remove_load"><a class="viewcode-back" href="../../api.html#beamon.database.Database.remove_load">[docs]</a>    <span class="k">def</span> <span class="nf">remove_load</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Remove load with certain index number.</span>

<span class="sd">        :param index: load index.</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DELETE FROM Load WHERE id=</span><span class="si">{index}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.remove_loads_with_node"><a class="viewcode-back" href="../../api.html#beamon.database.Database.remove_loads_with_node">[docs]</a>    <span class="k">def</span> <span class="nf">remove_loads_with_node</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;remove all forces and moments in relation with the node.</span>

<span class="sd">        :param index: of the node</span>
<span class="sd">        :return: True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_node</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;DELETE FROM Load WHERE node_id=</span><span class="si">{index}</span><span class="s1">;&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.get_all_lineloads"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_all_lineloads">[docs]</a>    <span class="k">def</span> <span class="nf">get_all_lineloads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all lineloads from Lineload table.</span>

<span class="sd">        :return: [link_id, qx, qy, qz, qw]</span>
<span class="sd">        :rtype: float matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;SELECT link_id, qx, qy, qz, qw FROM Lineload&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.change_lineload"><a class="viewcode-back" href="../../api.html#beamon.database.Database.change_lineload">[docs]</a>    <span class="k">def</span> <span class="nf">change_lineload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">l_index</span><span class="p">,</span> <span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">qz</span><span class="p">,</span> <span class="n">qw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Change lineload data with certain lineload index.</span>

<span class="sd">        :param index: lineload index number</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        :param l_index: link index number</span>
<span class="sd">        :type l_index: integer</span>
<span class="sd">        :param qx: constant force in x direction</span>
<span class="sd">        :type qx: float</span>
<span class="sd">        :param qy: constant force in y direction</span>
<span class="sd">        :type qy: float</span>
<span class="sd">        :param qz: constant force in z direction</span>
<span class="sd">        :type qz: float</span>
<span class="sd">        :param qw: constant momentum in x direction</span>
<span class="sd">        :type qw: float</span>
<span class="sd">        :return: True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;UPDATE Lineload SET link_id=</span><span class="si">{l_index}</span><span class="s2">, qx=</span><span class="si">{qx}</span><span class="s2">,qy=</span><span class="si">{qy}</span><span class="s2">,qz=</span><span class="si">{qz}</span><span class="s2">,qw=</span><span class="si">{qw}</span><span class="s2"> WHERE id=</span><span class="si">{index}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">l_index</span><span class="o">=</span><span class="n">l_index</span><span class="p">,</span> <span class="n">qx</span><span class="o">=</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="o">=</span><span class="n">qy</span><span class="p">,</span> <span class="n">qz</span><span class="o">=</span><span class="n">qz</span><span class="p">,</span> <span class="n">qw</span><span class="o">=</span><span class="n">qw</span>
            <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.add_lineload"><a class="viewcode-back" href="../../api.html#beamon.database.Database.add_lineload">[docs]</a>    <span class="k">def</span> <span class="nf">add_lineload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">l_index</span><span class="p">,</span> <span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="p">,</span> <span class="n">qz</span><span class="p">,</span> <span class="n">qw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Add a load to lineload table.</span>

<span class="sd">        :param l_index: link index number</span>
<span class="sd">        :type l_index: integer</span>
<span class="sd">        :param qx: constant force in x direction</span>
<span class="sd">        :type qx: float</span>
<span class="sd">        :param qy: constant force in y direction</span>
<span class="sd">        :type qy: float</span>
<span class="sd">        :param qz: constant force in z direction</span>
<span class="sd">        :type qz: float</span>
<span class="sd">        :param qw: constant momentum in x direction</span>
<span class="sd">        :type qw: float</span>
<span class="sd">        :return: True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;INSERT INTO Lineload (link_id, qx,qy,qz,qw) VALUES (</span><span class="si">{l_index}</span><span class="s2">,</span><span class="si">{qx}</span><span class="s2">,</span><span class="si">{qy}</span><span class="s2">,</span><span class="si">{qz}</span><span class="s2">,</span><span class="si">{qw}</span><span class="s2">)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="n">l_index</span><span class="o">=</span><span class="n">l_index</span><span class="p">,</span> <span class="n">qx</span><span class="o">=</span><span class="n">qx</span><span class="p">,</span> <span class="n">qy</span><span class="o">=</span><span class="n">qy</span><span class="p">,</span> <span class="n">qz</span><span class="o">=</span><span class="n">qz</span><span class="p">,</span> <span class="n">qw</span><span class="o">=</span><span class="n">qw</span>
        <span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.remove_lineload"><a class="viewcode-back" href="../../api.html#beamon.database.Database.remove_lineload">[docs]</a>    <span class="k">def</span> <span class="nf">remove_lineload</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes a certain load with index from lineload table.</span>

<span class="sd">        :param index: lineload index number</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Lineload WHERE id=</span><span class="si">{index}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.get_lineloads_for_plotting"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_lineloads_for_plotting">[docs]</a>    <span class="k">def</span> <span class="nf">get_lineloads_for_plotting</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets lineloads index with starting and ending node coordinates</span>
<span class="sd">         and lineload forces for plotting.</span>

<span class="sd">        :return: [link_id, x1,y1,z1,x2,y2,z2, qx,qy,qz,qw]</span>
<span class="sd">        :rtype: float matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span>
            <span class="s2">&quot;SELECT l.link_id id, n1.x x1, n1.y y1, n1.z z1, n2.x x2, n2.y y2, n2.z z2, l.qx, l.qy, l.qz, l.qw FROM Lineload l JOIN Links el ON l.link_id = el.id JOIN Nodes n1 ON el.n1_id = n1.id JOIN Nodes n2 ON el.n2_id = n2.id&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.import_text"><a class="viewcode-back" href="../../api.html#beamon.database.Database.import_text">[docs]</a>    <span class="k">def</span> <span class="nf">import_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This method is for importing geometry files to the database according to specified syntax in documentation.</span>
<span class="sd">        Keywords: *node, *element, *profile, *load, *lineload.</span>
<span class="sd">        Tables will be checked for integrity after import.</span>

<span class="sd">        :param path: of the text file to be imported</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># nodes = pd.read_sql_query(&quot;SELECT * FROM Nodes;&quot;, self.conn)</span>
        <span class="c1"># links = pd.read_sql_query(&quot;SELECT id,v_x,v_y,v_z,n1_id,n2_id,Profile_id FROM Links;&quot;, self.conn)</span>
        <span class="c1"># materials = pd.read_sql_query(&quot;SELECT * FROM Material&quot;, self.conn)</span>
        <span class="c1"># section = pd.read_sql_query(&quot;SELECT * FROM Section&quot;, self.conn)</span>
        <span class="c1"># profile = pd.read_sql_query(&quot;SELECT * FROM Profile&quot;, self.conn)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_database</span><span class="p">()</span>
        <span class="n">keywords</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;*node&quot;</span><span class="p">,</span> <span class="s2">&quot;*element&quot;</span><span class="p">,</span> <span class="s2">&quot;*profile&quot;</span><span class="p">,</span> <span class="s2">&quot;*load&quot;</span><span class="p">,</span> <span class="s2">&quot;*lineload&quot;</span><span class="p">]</span>
        <span class="c1"># nodes io writer</span>
        <span class="n">in_nodes</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">nodes_csv_writer</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">in_nodes</span><span class="p">)</span>
        <span class="n">nodes_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;u_x&#39;</span><span class="p">,</span> <span class="s1">&#39;u_y&#39;</span><span class="p">,</span> <span class="s1">&#39;u_z&#39;</span><span class="p">,</span> <span class="s1">&#39;phi_x&#39;</span><span class="p">,</span> <span class="s1">&#39;phi_y&#39;</span><span class="p">,</span> <span class="s1">&#39;phi_z&#39;</span><span class="p">,</span> <span class="s1">&#39;n_type&#39;</span><span class="p">])</span>
        <span class="c1"># elements io writer</span>
        <span class="n">in_links</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">links_csv_writer</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">in_links</span><span class="p">)</span>
        <span class="n">links_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;n1_id&#39;</span><span class="p">,</span> <span class="s1">&#39;n2_id&#39;</span><span class="p">,</span> <span class="s1">&#39;Profile_id&#39;</span><span class="p">,</span> <span class="s1">&#39;v_x&#39;</span><span class="p">,</span> <span class="s1">&#39;v_y&#39;</span><span class="p">,</span> <span class="s1">&#39;v_z&#39;</span><span class="p">])</span>
        <span class="c1"># profiles io writer</span>
        <span class="n">in_profiles</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">profiles_csv_writer</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">in_profiles</span><span class="p">)</span>
        <span class="n">profiles_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;Iy&#39;</span><span class="p">,</span> <span class="s1">&#39;Iz&#39;</span><span class="p">,</span> <span class="s1">&#39;kv&#39;</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">])</span>
        <span class="c1"># loads io writer</span>
        <span class="n">in_loads</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">loads_csv_writer</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">in_loads</span><span class="p">)</span>
        <span class="n">loads_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;node_id&#39;</span><span class="p">,</span> <span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="s1">&#39;m_x&#39;</span><span class="p">,</span> <span class="s1">&#39;m_y&#39;</span><span class="p">,</span> <span class="s1">&#39;m_z&#39;</span><span class="p">])</span>
        <span class="c1"># lineloads io writer</span>
        <span class="n">in_lineloads</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
        <span class="n">lineloads_csv_writer</span> <span class="o">=</span> <span class="n">writer</span><span class="p">(</span><span class="n">in_lineloads</span><span class="p">)</span>
        <span class="n">lineloads_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">([</span><span class="s1">&#39;link_id&#39;</span><span class="p">,</span> <span class="s1">&#39;qx&#39;</span><span class="p">,</span> <span class="s1">&#39;qy&#39;</span><span class="p">,</span> <span class="s1">&#39;qz&#39;</span><span class="p">,</span> <span class="s1">&#39;qw&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="n">default_bc</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># default nodes boundry condition</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">num</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
                    <span class="c1"># strip commented characters inside the line</span>
                    <span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;#.*&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>  <span class="c1"># regular expression for removing character after first &#39;#&#39;</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">):</span>  <span class="c1"># comment lines are still lines</span>
                        <span class="k">continue</span>

                    <span class="c1"># checking keywords</span>
                    <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">):</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keywords</span><span class="p">:</span>
                            <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                <span class="n">mode</span> <span class="o">=</span> <span class="n">keywords</span><span class="p">[</span><span class="n">keywords</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">key</span><span class="p">)]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;*&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                            <span class="k">else</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;File mode changed unexpectedly on line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                            <span class="k">continue</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;False keyword at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                    <span class="k">elif</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>  <span class="c1"># empty line --&gt; reset keyword</span>
                        <span class="n">mode</span> <span class="o">=</span> <span class="kc">None</span>
                        <span class="k">continue</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="c1"># reading input according to modes</span>
                        <span class="k">if</span> <span class="n">mode</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;No keyword selected for values at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                        <span class="c1"># behave according ot chosen mode</span>
                        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;node&quot;</span><span class="p">:</span>
                            <span class="c1"># append to nodes</span>
                            <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">numeric_string</span><span class="p">)</span> <span class="k">for</span> <span class="n">numeric_string</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
                                    <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;Missing values at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">9</span><span class="p">:</span>
                                    <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;too many values at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                                <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
                                    <span class="p">[</span><span class="n">default_bc</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))])</span>  <span class="c1"># append missing dof values</span>
                                <span class="n">nodes_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;No number value at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;element&#39;</span><span class="p">:</span>
                            <span class="c1"># append to links</span>
                            <span class="n">values_temp</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                            <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values_temp</span><span class="p">)):</span>
                                    <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>  <span class="c1"># profile id is optional argument</span>
                                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values_temp</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                            <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>
                                            <span class="k">continue</span>
                                        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">values_temp</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                                    <span class="k">else</span><span class="p">:</span>
                                        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">values_temp</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>

                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                                    <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;Missing values at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">6</span><span class="p">:</span>
                                    <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;too many values at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                                <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                                <span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
                                    <span class="c1"># profile id if given should be integer value only</span>
                                    <span class="k">if</span> <span class="ow">not</span> <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                                        <span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

                                <span class="c1"># append missing values</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                                    <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="kc">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
                                    <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
                                    <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
                                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="mi">5</span><span class="p">:</span>
                                    <span class="n">values</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="mi">0</span><span class="p">])</span>
                                <span class="n">links_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;No integer or float value at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;profile&quot;</span><span class="p">:</span>
                            <span class="c1"># append to profile</span>
                            <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="c1"># append missing values to row</span>
                                <span class="n">missing_values</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">missing_values</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">missing_values</span><span class="p">):</span>
                                        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                                    <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># try to convert to number value</span>
                                <span class="n">profiles_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;No number value at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;load&quot;</span><span class="p">:</span>
                            <span class="c1"># append to Loads</span>
                            <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="c1"># append missing values to row</span>
                                <span class="n">missing_values</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">missing_values</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">missing_values</span><span class="p">):</span>
                                        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                                    <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># try to convert to number value</span>
                                <span class="n">loads_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;No number value at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
                        <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;lineload&quot;</span><span class="p">:</span>
                            <span class="c1"># append to Loads</span>
                            <span class="n">values</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
                            <span class="k">try</span><span class="p">:</span>
                                <span class="c1"># append missing values to row</span>
                                <span class="n">missing_values</span> <span class="o">=</span> <span class="mi">5</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                                <span class="k">if</span> <span class="n">missing_values</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">missing_values</span><span class="p">):</span>
                                        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

                                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
                                    <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>  <span class="c1"># try to convert to number value</span>
                                <span class="n">lineloads_csv_writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
                            <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
                                <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span><span class="s2">&quot;No number value at line &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">num</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;File not Found: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>

        <span class="c1"># go back to the start of the StringIO</span>
        <span class="n">in_nodes</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">in_links</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">in_profiles</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">in_loads</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">in_lineloads</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># import the csv file into a dataframe</span>
        <span class="n">temp1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">in_nodes</span><span class="p">)</span>
        <span class="c1"># add id column at the beginning</span>
        <span class="n">temp1</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp1</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">temp1</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="c1"># do the same for other dataframes</span>
        <span class="n">temp2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">in_links</span><span class="p">)</span>
        <span class="n">temp2</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">temp2</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="c1">#</span>
        <span class="n">temp3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">in_profiles</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">temp3</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">temp3</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="c1"># temp3.fillna(None)</span>

        <span class="n">temp4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">in_loads</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">nan_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">temp4</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">nan_vec</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">temp4</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;lineload_id&#39;</span><span class="p">,</span> <span class="n">nan_vec</span><span class="p">)</span>
        <span class="n">temp4</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp4</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">temp4</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="n">temp5</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">in_lineloads</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">nan_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">temp5</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">nan_vec</span><span class="p">[:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">temp5</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">temp5</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
        <span class="n">temp5</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>

        <span class="c1"># insert into the database</span>
        <span class="n">temp1</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Nodes&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">temp2</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Links&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">temp3</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Profile&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">temp4</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">temp5</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Lineload&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># check databases foreign keys</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;PRAGMA foreign_key_check;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="c1"># no errors occurred</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># abort</span>
            <span class="k">raise</span> <span class="n">FileIntegrityError</span><span class="p">(</span>
                <span class="s2">&quot;Integrity check failed: Missing or wrong references. Check if id numbers are correct&quot;</span><span class="p">)</span>
        <span class="c1"># builds edof numbers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">make_edof</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.export_text"><a class="viewcode-back" href="../../api.html#beamon.database.Database.export_text">[docs]</a>    <span class="k">def</span> <span class="nf">export_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Exports geometry to text file</span>

<span class="sd">        :param path: the path including the File name to be saved (ex. filename.csv)</span>
<span class="sd">        :return: True if saved, False if not saved</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">nodes_table</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;SELECT x,y,z,u_x,u_y,u_z,phi_x,phi_y,phi_z FROM Nodes;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">links_table</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;SELECT n1_id, n2_id, Profile_id, v_x, v_y, v_z FROM Links;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">profiles_table</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;SELECT E, G, A, Iy, Iz, kv, k  FROM Profile&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">loads_table</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;SELECT node_id, x, y, z, m_x, m_y, m_z FROM Load WHERE lineload_id is NULL;&quot;</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">lineloads_table</span> <span class="o">=</span> <span class="n">sql</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="s2">&quot;SELECT link_id, qx, qy, qz, qw FROM lineload;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;*node</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">nodes_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_or_buf</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*element</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">links_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_or_buf</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*profile</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">profiles_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_or_buf</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*load</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">loads_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_or_buf</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*lineload</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="n">lineloads_table</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_or_buf</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">float_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="si">%g</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">x</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.is_settings_preset"><a class="viewcode-back" href="../../api.html#beamon.database.Database.is_settings_preset">[docs]</a>    <span class="k">def</span> <span class="nf">is_settings_preset</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks if settings table has already been changed or not.</span>

<span class="sd">        :return: True / False</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;SELECT id FROM VisualizerSettings&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.get_grid_settings"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_grid_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_grid_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets latest grid settings from table VisualizerSettings.</span>

<span class="sd">        :return: list of params / None if table is empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span>
            <span class="s2">&quot;SELECT grid_x1origin,grid_x2origin, grid_x3origin, grid_n1, grid_n2, grid_n3, grid_xtick, grid_ytick from VisualizerSettings&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>  <span class="c1"># use ORDER BY id DESC LIMIT 10</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_x1origin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_x2origin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_x3origin&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                  <span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_n1&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_n2&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_n3&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                  <span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_xtick&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;grid_ytick&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="Database.set_grid_settings"><a class="viewcode-back" href="../../api.html#beamon.database.Database.set_grid_settings">[docs]</a>    <span class="k">def</span> <span class="nf">set_grid_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets all grid settings to the table VisualizerSettings.</span>

<span class="sd">        :param params: (grid_x1origin,grid_x2origin, grid_x3origin, grid_n1, grid_n2, grid_n3, grid_xtick, grid_ytick)</span>
<span class="sd">        :type params: doubles list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if settings are set</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_settings_preset</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO VisualizerSettings (grid_x1origin,grid_x2origin, grid_x3origin, grid_n1, grid_n2, grid_n3, grid_xtick, grid_ytick) VALUES (?,?,?,?,?,?,?,?)&quot;</span><span class="p">,</span>
                <span class="n">params</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;UPDATE VisualizerSettings SET grid_x1origin=?,grid_x2origin=?, grid_x3origin=?, grid_n1=?, grid_n2=?, grid_n3=?, grid_xtick=?, grid_ytick=? WHERE id=1&quot;</span><span class="p">,</span>
                <span class="n">params</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.get_view_settings"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_view_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_view_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all view settings from table VisualizerSettings.</span>

<span class="sd">        :return: list of params / None if table is empty</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span>
            <span class="s2">&quot;SELECT view_dim, show_labels, show_local_systems, show_bc, show_node_loads, show_line_loads, show_color_bar from VisualizerSettings&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>  <span class="c1"># use ORDER BY id DESC LIMIT 10</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">params</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;view_dim&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;show_labels&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;show_local_systems&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;show_bc&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
                  <span class="n">df</span><span class="p">[</span><span class="s1">&#39;show_node_loads&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;show_line_loads&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;show_color_bar&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">params</span></div>

<div class="viewcode-block" id="Database.set_view_settings"><a class="viewcode-back" href="../../api.html#beamon.database.Database.set_view_settings">[docs]</a>    <span class="k">def</span> <span class="nf">set_view_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets all view settings to the table VisualizerSettings.</span>

<span class="sd">        :param params: list with 1 numbers following order (view_dim)</span>
<span class="sd">        :type params: doubles list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if settings are set</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_settings_preset</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO VisualizerSettings (view_dim, show_labels, show_local_systems, show_bc,show_node_loads, show_line_loads, show_color_bar) VALUES (?, ?, ?,?,?, ?, ?)&quot;</span><span class="p">,</span>
                <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">6</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;UPDATE VisualizerSettings SET view_dim=?, show_labels=?, show_local_systems=?, show_bc=?,show_node_loads=?, show_line_loads=?, show_color_bar=? WHERE id=1 &quot;</span><span class="p">,</span>
                <span class="p">[</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">6</span><span class="p">]])</span></div>

<div class="viewcode-block" id="Database.get_results_view_settings"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_results_view_settings">[docs]</a>    <span class="k">def</span> <span class="nf">get_results_view_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get all results view settings from table VisualizerSettings.</span>

<span class="sd">        :return: results view map</span>
<span class="sd">        :rtype: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span>
            <span class="s2">&quot;SELECT disp_nodes, disp_elements, nodes_sup_forces_trans, nodes_sup_forces_mom, elements_section_forces, displacements_scale from VisualizerSettings&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>  <span class="c1"># use ORDER BY id DESC LIMIT 10</span>
        <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span> <span class="ow">or</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;disp_nodes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="n">results_view_map</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;disp nodes&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;disp_nodes&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;disp elements&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;disp_elements&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;nodes sup forces trans&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;nodes_sup_forces_trans&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;nodes sup forces mom&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;nodes_sup_forces_mom&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;elements section forces&#39;</span><span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;elements_section_forces&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="s1">&#39;displacements scale&#39;</span> <span class="p">:</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;displacements_scale&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">results_view_map</span></div>

<div class="viewcode-block" id="Database.set_results_view_settings"><a class="viewcode-back" href="../../api.html#beamon.database.Database.set_results_view_settings">[docs]</a>    <span class="k">def</span> <span class="nf">set_results_view_settings</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">map</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sets all results view settings to the table VisualizerSettings</span>

<span class="sd">        :param map: dictionary to map each parameter</span>
<span class="sd">        :type map: dict</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># check if settings are set</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_settings_preset</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;INSERT INTO VisualizerSettings (disp_nodes, disp_elements, nodes_sup_forces_trans, nodes_sup_forces_mom, elements_section_forces, displacements_scale) VALUES (?, ?, ?, ?, ?, ?)&quot;</span><span class="p">,</span>
                <span class="p">[</span><span class="nb">map</span><span class="p">[</span><span class="s1">&#39;disp nodes&#39;</span><span class="p">],</span> <span class="nb">map</span><span class="p">[</span><span class="s1">&#39;disp elements&#39;</span><span class="p">],</span> <span class="nb">map</span><span class="p">[</span><span class="s1">&#39;nodes sup forces trans&#39;</span><span class="p">],</span> <span class="nb">map</span><span class="p">[</span><span class="s1">&#39;nodes sup forces mom&#39;</span><span class="p">],</span>
                 <span class="nb">map</span><span class="p">[</span><span class="s1">&#39;elements section forces&#39;</span><span class="p">],</span> <span class="nb">map</span><span class="p">[</span><span class="s1">&#39;displacements scale&#39;</span><span class="p">]])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s2">&quot;UPDATE VisualizerSettings SET disp_nodes=?, disp_elements=?, nodes_sup_forces_trans=?, nodes_sup_forces_mom=?, elements_section_forces=?, displacements_scale=? WHERE id=1 &quot;</span><span class="p">,</span>
                <span class="p">[</span><span class="nb">map</span><span class="p">[</span><span class="s1">&#39;disp nodes&#39;</span><span class="p">],</span> <span class="nb">map</span><span class="p">[</span><span class="s1">&#39;disp elements&#39;</span><span class="p">],</span> <span class="nb">map</span><span class="p">[</span><span class="s1">&#39;nodes sup forces trans&#39;</span><span class="p">],</span> <span class="nb">map</span><span class="p">[</span><span class="s1">&#39;nodes sup forces mom&#39;</span><span class="p">],</span>
                 <span class="nb">map</span><span class="p">[</span><span class="s1">&#39;elements section forces&#39;</span><span class="p">],</span> <span class="nb">map</span><span class="p">[</span><span class="s1">&#39;displacements scale&#39;</span><span class="p">]])</span></div>

<div class="viewcode-block" id="Database.sort_node_indexes"><a class="viewcode-back" href="../../api.html#beamon.database.Database.sort_node_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">sort_node_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset id column in Nodes table.</span>
<span class="sd">        All nodes primary keys will be resorted to ascending ordered integers from 1 to n (n is number of nodes).</span>
<span class="sd">        Warning: This method also resets foreign keys in Links and Loads tables that reference Nodes.</span>

<span class="sd">        :return: True: success/False: did not reset anything</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get dependent tables as pandas dataframes</span>
        <span class="n">nodes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Nodes;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">links</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Links;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Load;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="c1"># replace links indexes</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">links</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="n">id1</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;n1_id&#39;</span><span class="p">]</span>  <span class="c1"># old id</span>
            <span class="n">row1</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">id1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># new id according to row number (index[0])</span>
            <span class="n">id2</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;n2_id&#39;</span><span class="p">]</span>
            <span class="n">row2</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">id2</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
            <span class="n">links</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;n1_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row1</span>
            <span class="n">links</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;n2_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row2</span>
        <span class="c1"># replace loads indexes</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">load</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">load</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
                <span class="nb">id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;node_id&#39;</span><span class="p">]</span>
                <span class="n">row_id</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
                <span class="n">load</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;node_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_id</span>
        <span class="c1"># reset the index of Nodes table</span>
        <span class="n">nodes</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">nodes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="c1"># nodes.reset_index(inplace=True)</span>
        <span class="c1"># del nodes[&#39;id&#39;]</span>
        <span class="c1"># nodes.rename(columns={&#39;index&#39;: &#39;id&#39;}, inplace=True)</span>
        <span class="c1"># reset the index of Links table</span>
        <span class="n">links</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">links</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="n">load</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="c1"># links.reset_index(inplace=True)</span>
        <span class="c1"># del links[&#39;id&#39;]</span>
        <span class="c1"># links.rename(columns={&#39;index&#39;: &#39;id&#39;}, inplace=True)</span>

        <span class="c1"># replace tables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_links</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_node_loads</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_nodes_table</span><span class="p">()</span>
        <span class="n">nodes</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Nodes&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">links</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Links&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">load</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sort_edof</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.sort_profile_indexes"><a class="viewcode-back" href="../../api.html#beamon.database.Database.sort_profile_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">sort_profile_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset id column in Profile table.</span>
<span class="sd">        All profiles primary keys will be resorted to ascending ordered integers from 1 to n (n is number of nodes).</span>
<span class="sd">        Warning: This method also resets foreign keys in Links table that reference Profile</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">links</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Links;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">profiles</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Profile;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="c1"># replace profile indexes in links</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">links</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Profile_id&#39;</span><span class="p">]</span>  <span class="c1"># old id</span>
            <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="nb">id</span><span class="p">):</span>
                <span class="k">continue</span>
            <span class="n">row_num</span> <span class="o">=</span> <span class="n">profiles</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">profiles</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># new id according to row number (index[0])</span>
            <span class="n">links</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;Profile_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_num</span>
        <span class="c1"># reset id&#39;s</span>
        <span class="n">profiles</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">profiles</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">profiles</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="c1"># replace tables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_links</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_profile_table</span><span class="p">()</span>
        <span class="n">links</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Links&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">profiles</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Profile&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.sort_link_indexes"><a class="viewcode-back" href="../../api.html#beamon.database.Database.sort_link_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">sort_link_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset id column in Links table.</span>
<span class="sd">        All Links primary keys will be resorted to ascending ordered integers from 1 to n (n is number of links).</span>
<span class="sd">        Warning: This method also resets foreign keys in Lineload table that reference Links</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">links</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Links;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">lineloads</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Lineload;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="c1"># replace link indexes in lineloads</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">lineloads</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
            <span class="nb">id</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;link_id&#39;</span><span class="p">]</span>
            <span class="n">row_num</span> <span class="o">=</span> <span class="n">links</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">links</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="nb">id</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># new id according to row number (index[0])</span>
            <span class="n">lineloads</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;link_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">row_num</span>
        <span class="c1"># reset ids</span>
        <span class="n">links</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">links</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_links</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_lineloads</span><span class="p">()</span>
        <span class="n">links</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Links&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">lineloads</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Lineloads&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.sort_load_indexes"><a class="viewcode-back" href="../../api.html#beamon.database.Database.sort_load_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">sort_load_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset id column in Load table.</span>
<span class="sd">        All Load primary keys will be resorted to ascending ordered integers from 1 to n (n is number of Load).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">load</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Load;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">load</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">load</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">load</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_lineloads</span><span class="p">()</span>
        <span class="n">load</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Load&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.sort_lineload_indexes"><a class="viewcode-back" href="../../api.html#beamon.database.Database.sort_lineload_indexes">[docs]</a>    <span class="k">def</span> <span class="nf">sort_lineload_indexes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Reset id column in Lineload table.</span>
<span class="sd">        All Lineloads primary keys will be resorted to ascending ordered integers from 1 to n (n is number of Lineloads).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">lineloads</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT * FROM Lineload;&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">lineloads</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">lineloads</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">lineloads</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">clear_lineloads</span><span class="p">()</span>
        <span class="n">lineloads</span><span class="o">.</span><span class="n">to_sql</span><span class="p">(</span><span class="s2">&quot;Lineloads&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">,</span> <span class="n">if_exists</span><span class="o">=</span><span class="s2">&quot;append&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></div>

<div class="viewcode-block" id="Database.get_lost_dependencies"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_lost_dependencies">[docs]</a>    <span class="k">def</span> <span class="nf">get_lost_dependencies</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This method gets nodes indexes from Links and node loads that are not connected anymore.</span>
<span class="sd">        Warning: Using this method means you could have lost data and generated a delete anomaly in the database</span>
<span class="sd">        TODO: use this method in integrity check</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># m1: nodes ids in links</span>
        <span class="c1"># m2: nodes ids</span>
        <span class="c1"># Algebra expression:</span>
        <span class="c1"># (m1 U m2) \ m1</span>
        <span class="c1"># for further explanation see Documentation</span>
        <span class="n">lost_links_left</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT n1_id id From Links EXCEPT SELECT id FROM Nodes&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="n">lost_links_right</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT n2_id id From Links EXCEPT SELECT id FROM Nodes&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="c1"># outer join exclusion</span>
        <span class="n">lost_links</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">lost_links_left</span><span class="p">,</span> <span class="n">lost_links_right</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
        <span class="c1"># Loads</span>
        <span class="n">lost_loads</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span><span class="s2">&quot;SELECT node_id id From Load EXCEPT SELECT id FROM Nodes&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">lost_links</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">(),</span> <span class="n">lost_loads</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">_get_all_links</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT id, n1_id, n2_id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2 FROM Links&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()</span>

    <span class="c1"># def sort_edof(self):</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     This method sorts all edof numbers according to their connectivity information.</span>
    <span class="c1">#     This method removes all gaps in edof numbers.</span>
    <span class="c1">#     Warning: All indexes of nodes and links should be sorted without spaces (see sort_node_indexes)</span>
    <span class="c1">#     &quot;&quot;&quot;</span>
    <span class="c1">#     mem = {}  # momorize identical dof numbers</span>
    <span class="c1">#</span>
    <span class="c1">#     links = pd.read_sql_query(&quot;SELECT * FROM Links&quot;,</span>
    <span class="c1">#                               self.conn)</span>
    <span class="c1">#     if links.empty:</span>
    <span class="c1">#         return</span>
    <span class="c1">#     i = 1</span>
    <span class="c1">#     for index, row in links.iterrows():</span>
    <span class="c1">#         col_no = 0</span>
    <span class="c1">#         for key, value in row.iteritems():</span>
    <span class="c1">#             if col_no &lt;= 6:</span>
    <span class="c1">#                 col_no += 1</span>
    <span class="c1">#                 continue</span>
    <span class="c1">#             if value == 0:  # if dof not set keep it unset</span>
    <span class="c1">#                 links.at[index, key] = i</span>
    <span class="c1">#             elif mem.get(value) is None:  # if dof number not already set use a new number</span>
    <span class="c1">#                 mem[value] = i</span>
    <span class="c1">#                 # assign the new value to the table</span>
    <span class="c1">#                 links.at[index, key] = i</span>
    <span class="c1">#                 i += 1</span>
    <span class="c1">#             else:</span>
    <span class="c1">#                 links.at[index, key] = mem[value]  # otherwise use dof number from memory</span>
    <span class="c1">#             col_no += 1</span>
    <span class="c1">#</span>
    <span class="c1">#     # update database</span>
    <span class="c1">#     self.clear_links()  # to prevent altering primary key</span>
    <span class="c1">#     links.to_sql(&quot;Links&quot;, self.conn, if_exists=&quot;append&quot;, index=False)</span>
    <span class="c1">#     # TODO: remove</span>
    <span class="c1">#     print(self.get_edof())</span>

<div class="viewcode-block" id="Database.clear_database"><a class="viewcode-back" href="../../api.html#beamon.database.Database.clear_database">[docs]</a>    <span class="k">def</span> <span class="nf">clear_database</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete/erase all the data from the database tables</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM LineLoad;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Links;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Load;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Lineload;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Nodes;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Profile;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;DELETE FROM &quot;VisualizerSettings&quot;;&quot;&quot;&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.clear_node_loads"><a class="viewcode-back" href="../../api.html#beamon.database.Database.clear_node_loads">[docs]</a>    <span class="k">def</span> <span class="nf">clear_node_loads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete all the data from the table Force</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Load&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.clear_lineloads"><a class="viewcode-back" href="../../api.html#beamon.database.Database.clear_lineloads">[docs]</a>    <span class="k">def</span> <span class="nf">clear_lineloads</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete all the data from the table Lineload. ON DELTE CASCADE will deal with delete anomalies</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Lineload&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.clear_links"><a class="viewcode-back" href="../../api.html#beamon.database.Database.clear_links">[docs]</a>    <span class="k">def</span> <span class="nf">clear_links</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete all the data from the table Links</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Links&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.clear_profile_table"><a class="viewcode-back" href="../../api.html#beamon.database.Database.clear_profile_table">[docs]</a>    <span class="k">def</span> <span class="nf">clear_profile_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete all the data from the table Profile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Profile&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.clear_nodes_table"><a class="viewcode-back" href="../../api.html#beamon.database.Database.clear_nodes_table">[docs]</a>    <span class="k">def</span> <span class="nf">clear_nodes_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Delete all the data from the table Profile</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;DELETE FROM Nodes&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span></div>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<div class="viewcode-block" id="Database.get_edof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_edof">[docs]</a>    <span class="k">def</span> <span class="nf">get_edof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all links indices and degrees of freedom from links table.</span>

<span class="sd">        :return: [id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2]</span>
<span class="sd">        :rtype: integer matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">edof</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql_query</span><span class="p">(</span>
            <span class="s2">&quot;SELECT id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2 FROM Links&quot;</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">edof</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">edof</span></div>

<div class="viewcode-block" id="Database.get_edof_for_simulation"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_edof_for_simulation">[docs]</a>    <span class="k">def</span> <span class="nf">get_edof_for_simulation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets all links starting and ending nodes indices with degrees of freedom from links table.</span>

<span class="sd">        :return: [n1_id, n2_id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2]</span>
<span class="sd">        :rtype: integer matrix</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s2">&quot;SELECT n1_id, n2_id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2 FROM Links&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span></div>

<div class="viewcode-block" id="Database.change_edof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.change_edof">[docs]</a>    <span class="k">def</span> <span class="nf">change_edof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">edof</span><span class="p">,</span> <span class="n">n_index</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">e_index</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Changes given degrees of freedom for all elements connected to the node with index.</span>
<span class="sd">        If e_index is given only the degrees of freedom for that element will be changed.</span>

<span class="sd">        :param n_index: index of the node | integer</span>
<span class="sd">        :param edof: list of integers [ux1, uy1, uz1, phix1, ... , uz2, phix2, phiy2, phiz2]</span>
<span class="sd">        :param e_index: index of the element | integer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">e_index</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">contains_link</span><span class="p">(</span><span class="n">e_index</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s1">&#39;UPDATE Links SET ux1=</span><span class="si">{ux1}</span><span class="s1">,uy1=</span><span class="si">{uy1}</span><span class="s1"> ,uz1=</span><span class="si">{uz1}</span><span class="s1"> ,phix1=</span><span class="si">{phix1}</span><span class="s1">,phiy1=</span><span class="si">{phiy1}</span><span class="s1">,phiz1=</span><span class="si">{phiz1}</span><span class="s1"> WHERE id=</span><span class="si">{eid}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">eid</span><span class="o">=</span><span class="n">e_index</span><span class="p">,</span> <span class="n">ux1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">uy1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">uz1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">phix1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">phiy1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span>
                    <span class="n">phiz1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s1">&#39;UPDATE Links SET ux2=</span><span class="si">{ux2}</span><span class="s1">,uy2=</span><span class="si">{uy2}</span><span class="s1"> ,uz2=</span><span class="si">{uz2}</span><span class="s1"> ,phix2=</span><span class="si">{phix2}</span><span class="s1">,phiy2=</span><span class="si">{phiy2}</span><span class="s1">,phiz2=</span><span class="si">{phiz2}</span><span class="s1"> WHERE id=</span><span class="si">{eid}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="n">eid</span><span class="o">=</span><span class="n">e_index</span><span class="p">,</span> <span class="n">ux2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">uy2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">uz2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">phix2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">phiy2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span>
                    <span class="n">phiz2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
                <span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s1">&#39;UPDATE Links SET ux1=</span><span class="si">{ux1}</span><span class="s1">,uy1=</span><span class="si">{uy1}</span><span class="s1"> ,uz1=</span><span class="si">{uz1}</span><span class="s1"> ,phix1=</span><span class="si">{phix1}</span><span class="s1">,phiy1=</span><span class="si">{phiy1}</span><span class="s1">,phiz1=</span><span class="si">{phiz1}</span><span class="s1"> WHERE n1_id=</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="n">n_index</span><span class="p">,</span> <span class="n">ux1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">uy1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">uz1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">phix1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">phiy1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">phiz1</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
                <span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s1">&#39;UPDATE Links SET ux2=</span><span class="si">{ux2}</span><span class="s1">,uy2=</span><span class="si">{uy2}</span><span class="s1"> ,uz2=</span><span class="si">{uz2}</span><span class="s1"> ,phix2=</span><span class="si">{phix2}</span><span class="s1">,phiy2=</span><span class="si">{phiy2}</span><span class="s1">,phiz2=</span><span class="si">{phiz2}</span><span class="s1"> WHERE n2_id=</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                    <span class="nb">id</span><span class="o">=</span><span class="n">n_index</span><span class="p">,</span> <span class="n">ux2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">uy2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">uz2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> <span class="n">phix2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">9</span><span class="p">],</span> <span class="n">phiy2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">10</span><span class="p">],</span> <span class="n">phiz2</span><span class="o">=</span><span class="n">edof</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span>
                <span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="Database.get_default_static_edof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_default_static_edof">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_static_edof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets the default element degrees of freedom. Default means that all degrees of freedom are locked</span>
<span class="sd">        (stiff connections).</span>

<span class="sd">        :param id1: index of starting node</span>
<span class="sd">        :param id2: index of ending node</span>
<span class="sd">        :return: integer list [ux1, uy1, uz1, phix1, ... , uz2, phix2, phiy2, phiz2]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_links</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">13</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;SELECT n1_id, n2_id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2 FROM Links WHERE n1_id=</span><span class="si">{id1}</span><span class="s1"> and n2_id=</span><span class="si">{id2}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="n">id1</span><span class="o">=</span><span class="n">id1</span><span class="p">,</span> <span class="n">id2</span><span class="o">=</span><span class="n">id2</span><span class="p">))</span>
        <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">start_dof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">end_dof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">start_dof</span><span class="p">,</span> <span class="n">end_dof</span><span class="p">))</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span></div>

<div class="viewcode-block" id="Database.get_default_edof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_default_edof">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_edof</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Gets default element degrees of freedom numbers for a specific link.</span>

<span class="sd">        :param index: link index number</span>
<span class="sd">        :type index: integer</span>
<span class="sd">        :return: 1 x 12 array</span>
<span class="sd">        :rtype: integer array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s1">&#39;SELECT n1_id, n2_id, ux1,uy1,uz1,phix1,phiy1,phiz1,ux2,uy2,uz2,phix2,phiy2,phiz2 FROM Links WHERE id=</span><span class="si">{id}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="n">index</span><span class="p">))</span>
        <span class="n">link</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">zeros_indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">start_dof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">end_dof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">default_edof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">start_dof</span><span class="p">,</span> <span class="n">end_dof</span><span class="p">))</span>
        <span class="n">default_edof</span><span class="p">[</span><span class="n">zeros_indexes</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">return</span> <span class="n">default_edof</span></div>

<div class="viewcode-block" id="Database.make_edof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.make_edof">[docs]</a>    <span class="k">def</span> <span class="nf">make_edof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Create element degrees of freedom numbers by iterating over nodes.</span>
<span class="sd">        This method sorts all dof numbers according to connectivity information</span>
<span class="sd">        This method is used when reading input files</span>
<span class="sd">        TODO: consider Joints</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_links</span><span class="p">():</span>
            <span class="k">return</span>  <span class="c1"># abort</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_links</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_edof</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default_static_edof</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">link</span><span class="p">[</span><span class="mi">2</span><span class="p">]),</span> <span class="n">e_index</span><span class="o">=</span><span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="Database.sort_edof"><a class="viewcode-back" href="../../api.html#beamon.database.Database.sort_edof">[docs]</a>    <span class="k">def</span> <span class="nf">sort_edof</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Resets edof numbers counting to 1 while keeping previous connection information.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_links</span><span class="p">():</span>
            <span class="k">return</span>  <span class="c1"># abort</span>
        <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_all_links</span><span class="p">():</span>
            <span class="n">zeros_indexes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
            <span class="n">default_edof</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default_static_edof</span><span class="p">(</span><span class="n">link</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">link</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
            <span class="n">default_edof</span><span class="p">[</span><span class="n">zeros_indexes</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">change_edof</span><span class="p">(</span><span class="n">default_edof</span><span class="p">,</span> <span class="n">e_index</span><span class="o">=</span><span class="n">link</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span></div>

<div class="viewcode-block" id="Database.get_joints"><a class="viewcode-back" href="../../api.html#beamon.database.Database.get_joints">[docs]</a>    <span class="k">def</span> <span class="nf">get_joints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Get joints locations. Those are nodes coordinates + v. v is the direction of links from joints.</span>

<span class="sd">        :return: [x,y,z]</span>
<span class="sd">        :rtype: float array</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get links coordinates which have free dof numbers</span>
        <span class="c1"># links starting nodes joints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT n2.x - n1.x x, n2.y - n1.y y, n2.z - n1.z z, n1.x nx, n1.y ny, n1.z nz FROM Links l JOIN Nodes n1 ON l.n1_id = n1.id JOIN Nodes n2 ON l.n2_id = n2.id WHERE l.ux1=0 OR l.uy1=0 OR l.uz1=0 OR l.phix1=0 OR l.phiy1=0 OR l.phiz1=0&quot;</span><span class="p">)</span>
        <span class="n">first_joints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>
        <span class="c1"># links ending nodes joints</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
            <span class="s2">&quot;SELECT n1.x - n2.x x, n1.y - n2.y y, n1.z - n2.z z, n2.x nx, n2.y ny, n2.z nz FROM Links l JOIN Nodes n1 ON l.n1_id = n1.id JOIN Nodes n2 ON l.n2_id = n2.id WHERE l.ux2=0 OR l.uy2=0 OR l.uz2=0 OR l.phix2=0 OR l.phiy2=0 OR l.phiz2=0&quot;</span><span class="p">)</span>
        <span class="n">second_joints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cur</span><span class="o">.</span><span class="n">fetchall</span><span class="p">())</span>
        <span class="c1"># joints only at the end of links</span>
        <span class="k">if</span> <span class="n">first_joints</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="n">second_joints</span>
        <span class="c1"># joints only at the beginning of links</span>
        <span class="k">if</span> <span class="n">second_joints</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="n">first_joints</span>
        <span class="c1"># joints at beginning at end of links</span>
        <span class="k">if</span> <span class="n">first_joints</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">second_joints</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">joints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">first_joints</span><span class="p">,</span> <span class="n">second_joints</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">joints</span><span class="p">)):</span>
            <span class="c1"># (x,y,z) + 0.005 * v</span>
            <span class="n">joints</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">joints</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">3</span><span class="p">:]</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="p">(</span><span class="n">joints</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">joints</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">joints</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">joints</span>
        <span class="k">return</span> <span class="n">joints</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span></div></div>
</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../index.html">
    <img class="logo" src="../../_static/sla-logo2.png" alt="Logo"/>
    
  </a>
</p>








<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../making_a_model.html">Making A Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../theory.html">Theory</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contrib.html">Contributing</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2020, Maher Albezem.
      
    </div>

    

    
  </body>
</html>